<ng-container *ngIf="currentUser$ | async as user">
  <mat-toolbar color="primary" class="header-toolbar">

    <!-- BACK BUTTON (hidden on /tasks) -->
    <button
      *ngIf="showBackButton"
      mat-icon-button
      class="back-btn"
      (click)="goBack()"
    >
      <mat-icon>arrow_back</mat-icon>
    </button>

    <!-- APP TITLE -->
    <span class="app-title" (click)="goToTasks()">
      Task Manager
    </span>

    <span class="spacer"></span>

    <!-- ADMIN PANEL BUTTON -->
    <button
      *ngIf="user?.role === 'admin'"
      mat-button
      class="admin-btn"
    >
      <mat-icon>admin_panel_settings</mat-icon>
      Admin Panel
    </button>

    <!-- NOTIFICATION BELL -->
    <button
      mat-icon-button
      [matMenuTriggerFor]="notifMenu"
      class="notification-button"
    >
      <mat-icon>notifications</mat-icon>

      <!-- Badge -->
      <span class="badge" *ngIf="unreadCount > 0">
        {{ unreadCount }}
      </span>
    </button>

    <!-- NOTIFICATION DROPDOWN -->
    <mat-menu #notifMenu="matMenu" class="notifications-menu">

      <button mat-menu-item disabled *ngIf="notifications.length === 0">
        No Notifications
      </button>

      <ng-container *ngFor="let n of notifications">
        <button mat-menu-item [ngClass]="{ unread: !n.read }">
          <mat-icon class="notif-icon">notifications</mat-icon>
          <div class="notif-text">
            <strong>{{ n.message }}</strong><br />
            <small>{{ n.createdAt | date: 'short' }}</small>
          </div>
        </button>
      </ng-container>

      <mat-divider></mat-divider>

      <button mat-menu-item *ngIf="unreadCount > 0" (click)="markAllRead()">
        <mat-icon>done_all</mat-icon>
        Mark All Read
      </button>
    </mat-menu>

    <!-- USER MENU -->
    <button mat-button [matMenuTriggerFor]="userMenu">
      <mat-icon>account_circle</mat-icon>
      {{ user?.email }}
    </button>

    <mat-menu #userMenu="matMenu">
      <button mat-menu-item (click)="logout()">
        <mat-icon>logout</mat-icon>
        Logout
      </button>
    </mat-menu>

  </mat-toolbar>
</ng-container>
